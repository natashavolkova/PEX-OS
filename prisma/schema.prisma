datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id              String           @id
  email           String           @unique
  name            String?
  gridDensity     String           @default("standard") // 'standard' (4 cols) | 'high' (5 cols)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  projects        Project[]
  tasks           Task[]
  prompts         Prompt[]
  folders         Folder[]
  analyticsEvents AnalyticsEvent[]
  youtubeVideos   YouTubeVideo[]
  neovimConfigs   NeovimConfig[]
}

model Project {
  id          String   @id @default(cuid())
  name        String
  description String?
  status      String   @default("active")
  progress    Int      @default(0)
  members     Int      @default(1)
  dueDate     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId      String
  user        User     @relation(fields: [userId], references: [id])
}

model Task {
  id        String   @id @default(cuid())
  title     String
  status    String   @default("todo")
  priority  String   @default("medium")
  dueDate   DateTime?
  tags      String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

model Prompt {
  id        String   @id @default(cuid())
  title     String
  content   String
  type      String   @default("prompt")
  emoji     String?
  category  String?
  tags      String[]
  version   Int      @default(1)
  isFavorite Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  folderId  String?
  folder    Folder?  @relation(fields: [folderId], references: [id])
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

model Folder {
  id        String   @id @default(cuid())
  name      String
  type      String   @default("folder")
  emoji     String?
  isSystem  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  parentId  String?
  parent    Folder?  @relation("FolderHierarchy", fields: [parentId], references: [id])
  children  Folder[] @relation("FolderHierarchy")
  prompts   Prompt[]
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

// ============================================================================
// NEW MODELS FOR LOTE #4
// ============================================================================

model AnalyticsEvent {
  id        String   @id @default(cuid())
  type      String   // 'focus_start', 'focus_end', 'task_complete', 'prompt_create', etc.
  metadata  Json?    // Additional event data
  duration  Int?     // Duration in minutes (for focus sessions)
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
  @@index([type])
}

model YouTubeVideo {
  id           String   @id @default(cuid())
  videoId      String   @unique
  title        String
  channelName  String?
  thumbnailUrl String?
  watchStatus  String   @default("unwatched") // 'unwatched', 'watching', 'watched', 'revisit'
  notes        String?
  insights     Json?    // Array of extracted insights
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  userId       String
  user         User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([watchStatus])
}

model NeovimConfig {
  id         String   @id @default(cuid())
  name       String
  base       String   // 'lazyvim', 'astronvim', 'custom'
  lspConfigs String[] // Enabled LSP servers
  plugins    String[] // Enabled plugins
  content    String   // Generated init.lua content
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  userId     String
  user       User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

